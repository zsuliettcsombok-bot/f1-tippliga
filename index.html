<!-- =================== SUPABASE + AUTH TELJES =================== -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ===== SUPABASE ADATOK =====
  const SUPABASE_URL = "https://mtobtiwoiqqxdkduvjmf.supabase.co";
  const SUPABASE_ANON_KEY = "IDE_JÖN_A_TE_ANON_KULCSOD";
  // ===========================

  const supabaseClient = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  // ===== HASH NAVIGÁCIÓ =====
  function goto(hash) {
    location.hash = hash;
  }

  function showView(name) {
    const views = ["home", "rules", "scoring", "rank", "login"];
    views.forEach(v => {
      const el = document.getElementById("view-" + v);
      if (el) el.classList.toggle("hidden", v !== name);
    });
  }

  function route() {
    const h = (location.hash || "#home").replace("#", "");
    showView(["home","rules","scoring","rank","login"].includes(h) ? h : "home");
  }

  window.addEventListener("hashchange", route);
  route();

  // ===== SUPABASE TESZT (EZ VOLT MÁR JÓ) =====
  async function testSupabase() {
    const out = document.getElementById("login-output");
    out.innerText = "⏳ Supabase teszt...";
    try {
      const { data, error } = await supabaseClient
        .from("teams")
        .select("*")
        .limit(1);

      if (error) throw error;

      out.innerText =
        "✅ Supabase OK. teams sample: " + JSON.stringify(data || []);
    } catch (e) {
      out.innerText = "❌ Supabase hiba: " + (e.message || e);
    }
  }

  // ===== GITHUB BELÉPÉS =====
  async function loginWithGithub() {
    const out = document.getElementById("login-output");
    out.innerText = "⏳ GitHub belépés indítása...";

    const redirectTo =
      window.location.origin + window.location.pathname;

    const { error } = await supabaseClient.auth.signInWithOAuth({
      provider: "github",
      options: { redirectTo }
    });

    if (error) {
      out.innerText = "❌ GitHub login hiba: " + error.message;
    }
  }

  // ===== AUTH ÁLLAPOT FIGYELÉS =====
  supabaseClient.auth.onAuthStateChange((event, session) => {
    const out = document.getElementById("login-output");
    if (!out) return;

    if (event === "SIGNED_IN" && session?.user) {
      out.innerText =
        "✅ Bejelentkezve GitHubbal: " +
        (session.user.user_metadata?.user_name ||
         session.user.email ||
         session.user.id);

      goto("#home");
    }

    if (event === "SIGNED_OUT") {
      out.innerText = "ℹ️ Kijelentkezve";
    }
  });

  // ===== OLDAL BETÖLTÉSKORI SESSION ELLENŐRZÉS =====
  (async () => {
    const { data } = await supabaseClient.auth.getSession();
    const session = data?.session;
    const out = document.getElementById("login-output");
    if (out && session?.user) {
      out.innerText =
        "✅ Már be vagy lépve: " +
        (session.user.user_metadata?.user_name ||
         session.user.email ||
         session.user.id);
    }
  })();
</script>
<!-- ============================================================= -->
