<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>F1 2026 Tipp Liga</title>
  <style>
    :root{
      --bg1:#0b0b0f;
      --bg2:#2a0000;
      --card:rgba(0,0,0,.45);
      --border:rgba(255,255,255,.10);
      --text:#f3f3f3;
      --muted:rgba(255,255,255,.70);
      --red:#d8232a;
      --red2:#9b0000;
      --btn:#b10f12;
      --btn2:#e51f26;
      --ok:#1fbf6b;
      --warn:#ffb020;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 25% 15%, rgba(216,35,42,.35), transparent 60%),
        radial-gradient(900px 500px at 75% 85%, rgba(216,35,42,.20), transparent 60%),
        linear-gradient(135deg, var(--bg2), var(--bg1));
      min-height:100vh;
    }
    .topbar{
      position:sticky; top:0; z-index:10;
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 18px;
      background:linear-gradient(180deg, rgba(0,0,0,.70), rgba(0,0,0,.35));
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; gap:10px; align-items:center;
      font-weight:800; letter-spacing:.4px;
    }
    .pill{
      width:38px;height:38px;border-radius:999px;
      background:linear-gradient(135deg, var(--red2), var(--red));
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 8px 22px rgba(0,0,0,.35);
      font-weight:900;
    }
    .nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .nav a{
      text-decoration:none;
      color:var(--text);
      padding:10px 14px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      border:1px solid var(--border);
      font-weight:700;
    }
    .nav a.active{background:rgba(216,35,42,.22); border-color:rgba(216,35,42,.35)}
    .wrap{max-width:1200px; margin:24px auto; padding:0 16px}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:0 18px 44px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .card-h{
      padding:18px 18px 14px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, rgba(216,35,42,.16), transparent);
    }
    .card-h h2{margin:0;font-size:22px}
    .card-b{padding:18px}
    .row{display:flex; gap:14px; flex-wrap:wrap}
    .col{flex:1; min-width:280px}
    .btn{
      cursor:pointer;
      border:none;
      padding:12px 14px;
      border-radius:14px;
      color:white;
      font-weight:800;
      background:linear-gradient(135deg, var(--btn), var(--btn2));
      box-shadow:0 12px 26px rgba(0,0,0,.35);
      display:inline-flex; gap:10px; align-items:center;
    }
    .btn.secondary{
      background:rgba(0,0,0,.35);
      border:1px solid var(--border);
      box-shadow:none;
      color:var(--text);
    }
    .btn.small{padding:10px 12px; border-radius:12px; font-weight:800}
    .muted{color:var(--muted)}
    .status{
      margin-top:14px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      display:flex; gap:10px; align-items:center;
      min-height:44px;
    }
    .status .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:var(--ok)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:#ff3b3b}
    .foot{
      opacity:.7;
      text-align:center;
      padding:18px 10px 30px;
      font-size:13px;
    }

    /* races list */
    .list{
      display:grid;
      gap:10px;
    }
    .item{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
    }
    .item b{font-size:15px}
    .tag{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(216,35,42,.22);
      border:1px solid rgba(216,35,42,.35);
      color:var(--text);
      white-space:nowrap;
    }

    /* pick UI */
    .pickGrid{display:grid; grid-template-columns: 1fr 1fr; gap:14px}
    @media(max-width:900px){ .pickGrid{grid-template-columns:1fr} }
    .slot{
      border:1px dashed rgba(255,255,255,.25);
      background:rgba(0,0,0,.22);
      border-radius:16px;
      padding:12px;
      min-height:62px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .slot .num{
      width:40px;height:40px;border-radius:14px;
      display:grid;place-items:center;
      font-weight:900;
      background:rgba(216,35,42,.18);
      border:1px solid rgba(216,35,42,.28);
    }
    .slot .name{font-weight:850}
    .slot .empty{opacity:.55}
    .driverList{
      max-height:420px;
      overflow:auto;
      border:1px solid var(--border);
      border-radius:16px;
      background:rgba(0,0,0,.18);
    }
    .driver{
      padding:12px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .driver:last-child{border-bottom:none}
    .driver .left{display:flex; flex-direction:column; line-height:1.15}
    .driver .left b{font-size:14px}
    .driver .left span{font-size:12px; opacity:.7}
    .dragHint{opacity:.7; font-weight:800; font-size:12px}

    .okline{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(31,191,107,.35);
      background:rgba(31,191,107,.12);
      display:flex; gap:10px; align-items:center;
      font-weight:800;
    }
    .hide{display:none!important}
    input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    label{font-size:12px; opacity:.8; font-weight:800}
  </style>
</head>
<body>

  <div class="topbar">
    <div class="brand">
      <div class="pill">F1</div>
      <div>2026 TIPP LIGA</div>
    </div>
    <div class="nav" id="nav">
      <a href="#home" data-route="home">Kezd≈ë</a>
      <a href="#races" data-route="races">Versenynapt√°r</a>
      <a href="#standings" data-route="standings">Ranglista</a>
      <a href="#login" data-route="login">Bel√©p√©s</a>
    </div>
  </div>

  <div class="wrap">
    <!-- HOME -->
    <section class="card" id="page-home">
      <div class="card-h">
        <div class="tag">MVP ‚Ä¢ Futamlista ‚Üí Tipp oldal (drag & drop) + Ranglista</div>
        <h2 style="margin-top:12px;font-size:44px;letter-spacing:.3px">F1 2026 Tipp Liga</h2>
        <div class="muted" style="max-width:760px">
          F≈ëoldalon futamnapt√°r. Futamot kiv√°lasztva k√ºl√∂n Tipp oldalon h√∫zod be az 1‚Äì5. helyre a pil√≥t√°kat.
          Ment√©s Supabase-be.
        </div>
      </div>
      <div class="card-b">
        <div class="row">
          <button class="btn" id="go-races">üóìÔ∏è Versenynapt√°r</button>
          <button class="btn secondary" id="go-login">üîê Bel√©p√©s</button>
          <button class="btn secondary" id="btn-refresh">üîÑ Friss√≠t√©s</button>
        </div>

        <div class="status" id="status">
          <span class="dot warn" id="status-dot"></span>
          <span id="status-text">St√°tusz: ellen≈ërz√©s...</span>
        </div>
      </div>
    </section>

    <!-- RACES -->
    <section class="card hide" id="page-races" style="margin-top:16px">
      <div class="card-h">
        <h2>üóìÔ∏è Versenynapt√°r</h2>
        <div class="muted">Kattints egy futamra ‚Üí √°tvisz a Tipp oldalra.</div>
      </div>
      <div class="card-b">
        <div class="row">
          <button class="btn secondary small" id="races-back">‚¨ÖÔ∏è Vissza</button>
          <button class="btn small" id="races-refresh">üîÑ Lista friss√≠t√©se</button>
        </div>
        <div class="status" style="margin-top:14px">
          <span class="dot warn"></span>
          <span id="races-status">Futamok bet√∂lt√©se...</span>
        </div>
        <div class="list" id="races-list" style="margin-top:14px"></div>
      </div>
    </section>

    <!-- PICK -->
    <section class="card hide" id="page-pick" style="margin-top:16px">
      <div class="card-h">
        <h2 id="pick-title">üèÅ Tipp oldal</h2>
        <div class="muted" id="pick-sub">Futam adatok bet√∂lt√©se...</div>
      </div>
      <div class="card-b">
        <div class="row">
          <button class="btn secondary small" id="pick-back">‚¨ÖÔ∏è Vissza a futamokhoz</button>
          <button class="btn secondary small" id="pick-clear">üßπ T√∂rl√©s</button>
          <button class="btn secondary small" id="pick-remove">üóëÔ∏è Tipp t√∂rl√©se</button>
          <button class="btn small" id="pick-save">üíæ Tipp ment√©se</button>
        </div>

        <div class="pickGrid" style="margin-top:14px">
          <div class="col">
            <div class="tag" style="display:inline-block;margin-bottom:10px">Helyez√©sek (1‚Äì5)</div>
            <div id="slots"></div>
            <div class="okline hide" id="pick-loaded">
              ‚úÖ Kor√°bbi tipped bet√∂ltve.
            </div>
          </div>
          <div class="col">
            <div class="tag" style="display:inline-block;margin-bottom:10px">Pil√≥t√°k</div>
            <div class="muted" style="margin-bottom:10px">H√∫zd a pil√≥t√°t egy helyre.</div>
            <div class="driverList" id="drivers"></div>
          </div>
        </div>

        <div class="status" style="margin-top:14px">
          <span class="dot warn"></span>
          <span id="pick-status">Bet√∂lt√©s...</span>
        </div>
      </div>
    </section>

    <!-- LOGIN -->
    <section class="card hide" id="page-login" style="margin-top:16px">
      <div class="card-h">
        <h2>üîê Bel√©p√©s</h2>
        <div class="muted">Email + jelsz√≥ (Supabase Auth). Ha nincs fi√≥k, regisztr√°l.</div>
      </div>
      <div class="card-b">
        <div class="row">
          <div class="col">
            <label>Email</label>
            <input id="login-email" placeholder="email@valami.com" />
          </div>
          <div class="col">
            <label>Jelsz√≥</label>
            <input id="login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
        </div>
        <div class="row" style="margin-top:14px">
          <button class="btn" id="btn-signin">Bel√©p√©s</button>
          <button class="btn secondary" id="btn-signup">Regisztr√°ci√≥</button>
          <button class="btn secondary" id="btn-signout">Kijelentkez√©s</button>
          <button class="btn secondary" id="login-back">Vissza</button>
        </div>

        <div class="status">
          <span class="dot warn" id="login-dot"></span>
          <span id="login-status">√Ållapot: ellen≈ërz√©s...</span>
        </div>
      </div>
    </section>

    <!-- STANDINGS -->
    <section class="card hide" id="page-standings" style="margin-top:16px">
      <div class="card-h">
        <h2>üèÜ Ranglista</h2>
        <div class="muted">MVP-ben itt most csak a v√°z van (k√©s≈ëbb pontsz√°m√≠t√°s).</div>
      </div>
      <div class="card-b">
        <div class="status">
          <span class="dot warn"></span>
          <span>Hamarosan: pontsz√°m√≠t√°s + toplista (Supabase-b≈ël).</span>
        </div>
      </div>
    </section>

    <div class="foot">¬© F1 Tipp Liga 2026 ‚Ä¢ GitHub Pages ‚Ä¢ Supabase</div>
  </div>

  <!-- ======================= SUPABASE + APP ======================= -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script>

    // ==============================================================
    // ‚úÖ IDE CSAK A SAJ√ÅT SUPABASE ADATAID KELLENEK (2 sor)
    // ==============================================================

    const SUPABASE_URL = "https://mtobtiwoiqqxdkduvjmf.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10b2J0aXdvaXFxeGRrZHV2am1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgxMTY2NzAsImV4cCI6MjA4MzY5MjY3MH0.qB5tb9uj2GN4iKRvyZnv_lVRZ9xnlgtY3rN6oZV_LDc";

    // ==============================================================
    // ‚úÖ GitHub Pages base path (hash routingn√°l csak UI-hoz kell)
    // ==============================================================

    const BASE_PATH = (function(){
      const p = window.location.pathname;
      if (p.endsWith("/")) return p;
      return p.substring(0, p.lastIndexOf("/") + 1);
    })();

    // ==============================================================
    // ‚úÖ SUPABASE CLIENT (FONTOS: neve 'supabase', √≠gy supabase.from m≈±k√∂dik!)
    // ==============================================================

    const supabase = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY,
      {
        auth: {
          persistSession: true,
          autoRefreshToken: true,
          storage: window.localStorage
        }
      }
    );

    // ---------------- UI helpers ----------------
    const $ = (id)=>document.getElementById(id);
    const setActiveNav = (route)=>{
      document.querySelectorAll("#nav a").forEach(a=>{
        a.classList.toggle("active", a.dataset.route === route);
      });
    };
    const showPage = (route)=>{
      const pages = ["home","races","pick","login","standings"];
      pages.forEach(p => $("page-"+p).classList.add("hide"));
      $("page-"+route).classList.remove("hide");
      setActiveNav(route);
    };
    const goto = (hash)=>{ location.hash = hash; };

    // ---------------- App state ----------------
    let currentUser = null;
    let racesCache = [];
    let driversCache = [];
    let currentRaceId = null;
    let pickSlots = [null,null,null,null,null]; // drivers objects

    // ---------------- Status UI ----------------
    function setStatus(kind, text){
      const dot = $("status-dot");
      dot.classList.remove("ok","warn","bad");
      dot.classList.add(kind);
      $("status-text").textContent = text;
    }
    function setLoginStatus(kind, text){
      const dot = $("login-dot");
      dot.classList.remove("ok","warn","bad");
      dot.classList.add(kind);
      $("login-status").textContent = text;
    }

    // ---------------- Auth ----------------
    async function refreshAuth(){
      const { data } = await supabase.auth.getUser();
      currentUser = data?.user ?? null;
      if(currentUser){
        setStatus("ok", "Bejelentkezve: " + (currentUser.email || "felhaszn√°l√≥"));
        setLoginStatus("ok", "Bejelentkezve: " + (currentUser.email || "felhaszn√°l√≥"));
      }else{
        setStatus("warn", "Nincs bel√©pve. A ment√©shez bel√©p√©s kell.");
        setLoginStatus("warn", "Nincs bel√©pve.");
      }
    }
    supabase.auth.onAuthStateChange((_event, _session)=>{
      refreshAuth();
    });

    // ---------------- Data loading ----------------
    async function loadDrivers(){
      // v√°r: public.drivers: id, code, name, team
      const { data, error } = await supabase
        .from("drivers")
        .select("id, code, name, team")
        .order("name", { ascending: true });

      if(error) throw error;
      driversCache = data || [];
      return driversCache;
    }

    async function loadRaces(){
      // v√°r: public.races: id, round, name, city, start_date, end_date
      const { data, error } = await supabase
        .from("races")
        .select("id, round, name, city, start_date, end_date")
        .order("round", { ascending: true });

      if(error) throw error;
      racesCache = data || [];
      return racesCache;
    }

    // ---------------- Races page ----------------
    function formatRange(r){
      if(!r.start_date) return "";
      const s = String(r.start_date).slice(0,10);
      const e = r.end_date ? String(r.end_date).slice(0,10) : "";
      return e ? `${s} ‚Üí ${e}` : s;
    }

    function renderRaces(){
      const list = $("races-list");
      list.innerHTML = "";
      racesCache.forEach(r=>{
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <div>
            <b>Futam #${r.round || "?"} ‚Ä¢ ${r.name || "N√©v n√©lk√ºl"}</b>
            <div class="muted" style="font-size:12px;margin-top:2px">${r.city || ""} ‚Ä¢ ${formatRange(r)}</div>
          </div>
          <button class="btn small">Tipp ‚ûú</button>
        `;
        el.querySelector("button").addEventListener("click", ()=>{
          goto(`#pick?race=${encodeURIComponent(r.id)}`);
        });
        list.appendChild(el);
      });

      $("races-status").textContent = racesCache.length
        ? `Bet√∂ltve: ${racesCache.length} futam`
        : "Nincs futam a t√°bl√°ban.";
    }

    // ---------------- Pick page (drag&drop) ----------------
    function renderSlots(){
      const wrap = $("slots");
      wrap.innerHTML = "";
      for(let i=0;i<5;i++){
        const d = pickSlots[i];
        const el = document.createElement("div");
        el.className = "slot";
        el.dataset.index = String(i);
        el.innerHTML = `
          <div style="display:flex;align-items:center;gap:12px">
            <div class="num">#${i+1}</div>
            <div>
              <div class="name ${d ? "" : "empty"}">${d ? d.name : "H√∫zz ide egy pil√≥t√°t"}</div>
              <div class="muted" style="font-size:12px">${d ? (d.team || "") : ""}</div>
            </div>
          </div>
          <div class="dragHint">${d ? "H√∫zd √°t m√°shova" : ""}</div>
        `;

        // drop target
        el.addEventListener("dragover", (ev)=>{ ev.preventDefault(); });
        el.addEventListener("drop", (ev)=>{
          ev.preventDefault();
          const driverId = ev.dataTransfer.getData("text/driverId");
          if(!driverId) return;
          const drv = driversCache.find(x=>String(x.id)===String(driverId));
          if(!drv) return;
          placeDriver(i, drv);
        });

        wrap.appendChild(el);
      }
    }

    function renderDrivers(){
      const wrap = $("drivers");
      wrap.innerHTML = "";
      driversCache.forEach(d=>{
        const el = document.createElement("div");
        el.className = "driver";
        el.draggable = true;
        el.innerHTML = `
          <div class="left">
            <b>${d.name}</b>
            <span>${d.team || ""}</span>
          </div>
          <div class="dragHint">H√∫zd ‚Üí</div>
        `;
        el.addEventListener("dragstart",(ev)=>{
          ev.dataTransfer.setData("text/driverId", String(d.id));
        });
        wrap.appendChild(el);
      });
    }

    function placeDriver(slotIndex, driver){
      // ne legyen ugyanaz a driver t√∂bb slotban
      pickSlots = pickSlots.map(x => (x && x.id === driver.id) ? null : x);
      pickSlots[slotIndex] = driver;
      renderSlots();
    }

    function clearPick(){
      pickSlots = [null,null,null,null,null];
      $("pick-loaded").classList.add("hide");
      renderSlots();
    }

    async function loadExistingPick(raceId){
      $("pick-loaded").classList.add("hide");
      if(!currentUser) return;

      // v√°r: public.picks: user_id, race_id, positions (json)
      const { data, error } = await supabase
        .from("picks")
        .select("positions")
        .eq("user_id", currentUser.id)
        .eq("race_id", raceId)
        .maybeSingle();

      if(error) throw error;

      if(data?.positions){
        // positions: [driver_id,...] vagy [{id,name,team},...]
        const pos = data.positions;
        const ids = Array.isArray(pos) ? pos : [];
        // ha id lista:
        const resolved = ids.map(v=>{
          const id = (typeof v === "object" && v) ? v.id : v;
          return driversCache.find(d=>String(d.id)===String(id)) || null;
        });
        pickSlots = [
          resolved[0]||null, resolved[1]||null, resolved[2]||null, resolved[3]||null, resolved[4]||null
        ];
        renderSlots();
        $("pick-loaded").classList.remove("hide");
      }
    }

    async function savePick(){
      if(!currentUser){
        $("pick-status").textContent = "Ment√©shez bel√©p√©s kell.";
        goto("#login");
        return;
      }
      if(!currentRaceId){
        $("pick-status").textContent = "Nincs kiv√°lasztott futam.";
        return;
      }

      const positions = pickSlots.map(d=> d ? d.id : null);

      // legal√°bb 1 legyen
      const hasAny = positions.some(x=>x!==null);
      if(!hasAny){
        $("pick-status").textContent = "Nincs mit menteni (√ºres tipp).";
        return;
      }

      $("pick-status").textContent = "Ment√©s...";
      const { error } = await supabase
        .from("picks")
        .upsert(
          { user_id: currentUser.id, race_id: currentRaceId, positions },
          { onConflict: "user_id,race_id" }
        );

      if(error){
        console.error(error);
        $("pick-status").textContent = "Hiba ment√©skor: " + error.message;
        return;
      }
      $("pick-status").textContent = "Sikeres ment√©s ‚úÖ";
    }

    async function deletePick(){
      if(!currentUser || !currentRaceId) return;
      $("pick-status").textContent = "Tipp t√∂rl√©se...";
      const { error } = await supabase
        .from("picks")
        .delete()
        .eq("user_id", currentUser.id)
        .eq("race_id", currentRaceId);

      if(error){
        console.error(error);
        $("pick-status").textContent = "Hiba t√∂rl√©skor: " + error.message;
        return;
      }
      clearPick();
      $("pick-status").textContent = "Tipp t√∂r√∂lve ‚úÖ";
    }

    // ---------------- Router ----------------
    function parseHash(){
      const h = (location.hash || "#home").slice(1); // remove #
      const [route, query] = h.split("?");
      const params = new URLSearchParams(query || "");
      return { route: route || "home", params };
    }

    async function onRoute(){
      const { route, params } = parseHash();

      if(route === "home"){
        showPage("home");
        return;
      }

      if(route === "login"){
        showPage("login");
        return;
      }

      if(route === "standings"){
        showPage("standings");
        return;
      }

      if(route === "races"){
        showPage("races");
        $("races-status").textContent = "Futamok bet√∂lt√©se...";
        try{
          await loadRaces();
          renderRaces();
        }catch(e){
          console.error(e);
          $("races-status").textContent = "Hiba futam bet√∂lt√©sn√©l: " + (e?.message || e);
        }
        return;
      }

      if(route === "pick"){
        showPage("pick");
        const raceId = params.get("race");
        currentRaceId = raceId;

        if(!raceId){
          $("pick-title").textContent = "üèÅ Tipp oldal";
          $("pick-sub").textContent = "Nincs race param√©ter. Menj vissza a versenynapt√°rba.";
          $("pick-status").textContent = "Nincs futam.";
          return;
        }

        $("pick-status").textContent = "Bet√∂lt√©s...";
        try{
          // biztosan legyen driver cache
          if(!driversCache.length) await loadDrivers();
          renderDrivers();
          renderSlots();

          const race = racesCache.find(r=>String(r.id)===String(raceId));
          if(!racesCache.length) {
            try { await loadRaces(); } catch {}
          }
          const r2 = racesCache.find(r=>String(r.id)===String(raceId)) || race;
          $("pick-title").textContent = `üèÅ Tipp oldal (drag & drop)`;
          $("pick-sub").textContent = r2
            ? `Futam: #${r2.round || "?"} ‚Ä¢ ${r2.name || ""} ‚Ä¢ ${r2.city || ""} ‚Ä¢ ${formatRange(r2)}`
            : `Race ID: ${raceId}`;

          clearPick();
          await refreshAuth();
          await loadExistingPick(raceId);

          $("pick-status").textContent = "K√©sz.";
        }catch(e){
          console.error(e);
          $("pick-status").textContent = "Hiba: " + (e?.message || e);
        }
        return;
      }

      // default
      showPage("home");
    }

    // ---------------- Buttons wiring ----------------
    $("go-races").addEventListener("click", ()=>goto("#races"));
    $("go-login").addEventListener("click", ()=>goto("#login"));
    $("btn-refresh").addEventListener("click", async ()=>{
      await refreshAuth();
      setStatus(currentUser ? "ok" : "warn", currentUser ? "Friss√≠tve ‚úÖ" : "Friss√≠tve: nincs bel√©pve.");
    });

    $("races-back").addEventListener("click", ()=>goto("#home"));
    $("races-refresh").addEventListener("click", async ()=>{
      $("races-status").textContent = "Friss√≠t√©s...";
      try{
        await loadRaces();
        renderRaces();
      }catch(e){
        console.error(e);
        $("races-status").textContent = "Hiba: " + (e?.message || e);
      }
    });

    $("pick-back").addEventListener("click", ()=>goto("#races"));
    $("pick-clear").addEventListener("click", ()=>{ clearPick(); $("pick-status").textContent="√úr√≠tve."; });
    $("pick-save").addEventListener("click", savePick);
    $("pick-remove").addEventListener("click", deletePick);

    $("login-back").addEventListener("click", ()=>goto("#home"));

    $("btn-signin").addEventListener("click", async ()=>{
      const email = $("login-email").value.trim();
      const password = $("login-pass").value;
      if(!email || !password){ setLoginStatus("warn","Hi√°nyzik email vagy jelsz√≥."); return; }
      setLoginStatus("warn","Bel√©p√©s...");
      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if(error){ setLoginStatus("bad","Hiba: " + error.message); return; }
      setLoginStatus("ok","Sikeres bel√©p√©s ‚úÖ");
      goto("#home");
    });

    $("btn-signup").addEventListener("click", async ()=>{
      const email = $("login-email").value.trim();
      const password = $("login-pass").value;
      if(!email || !password){ setLoginStatus("warn","Hi√°nyzik email vagy jelsz√≥."); return; }
      setLoginStatus("warn","Regisztr√°ci√≥...");
      const { error } = await supabase.auth.signUp({ email, password });
      if(error){ setLoginStatus("bad","Hiba: " + error.message); return; }
      setLoginStatus("ok","Regisztr√°ci√≥ ok ‚úÖ (ha kell, email meger≈ës√≠t√©s).");
      goto("#home");
    });

    $("btn-signout").addEventListener("click", async ()=>{
      setLoginStatus("warn","Kijelentkez√©s...");
      const { error } = await supabase.auth.signOut();
      if(error){ setLoginStatus("bad","Hiba: " + error.message); return; }
      setLoginStatus("ok","Kijelentkezve ‚úÖ");
      goto("#home");
    });

    // ---------------- Init ----------------
    window.addEventListener("hashchange", onRoute);

    (async function init(){
      try{
        await refreshAuth();
        // el≈ët√∂lt√©s (ha ezek hib√°znak, akkor is legyen UI)
        try{ await loadDrivers(); }catch(e){ console.warn("drivers load failed", e); }
        try{ await loadRaces(); }catch(e){ console.warn("races load failed", e); }
        onRoute();
      }catch(e){
        console.error(e);
        setStatus("bad", "Inicializ√°l√°si hiba: " + (e?.message || e));
      }
    })();
  </script>
</body>
</html>
